<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ’¼ Cashflow System</title>
<style>
body{font-family:Arial;background:#f0f2f5;margin:0}
.container{width:95%;max-width:1200px;margin:20px auto}
.tabs{display:flex;gap:6px;margin:15px 0}
.tablink{padding:10px 18px;border:none;border-radius:8px;background:#ddd;font-weight:bold}
.tablink.active{background:#3498db;color:#fff}
.tabcontent{display:none}
.cards{display:flex;gap:10px;flex-wrap:wrap}
.card{background:#fff;padding:15px;border-radius:10px;flex:1;box-shadow:0 2px 5px rgba(0,0,0,.1)}
button{cursor:pointer}
#logoutBtn{background:#e74c3c;color:#fff;border:none;padding:6px 12px;border-radius:6px}
#profitSection{display:none}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
</style>
</head>
<body>
<div class="container">

<h1>ðŸ’¼ Cashflow System</h1>

<div class="tabs">
<button class="tablink active" onclick="openTab('dashboard',this)">Dashboard</button>
<button class="tablink" onclick="openTab('cashflow',this)">Cashflow</button>
<button class="tablink" onclick="openTab('rebalance',this)">Rebalance</button>
</div>

<div id="dashboard" class="tabcontent" style="display:block">
<div class="cards">
<div class="card"><h3>Cash</h3><p id="dashCash">â‚±0</p></div>
<div class="card"><h3>GCash</h3><p id="dashGcash">â‚±0</p></div>
<div class="card" id="profitSection"><h3>Profit</h3><p id="dashProfit">â‚±0</p></div>
<div class="card"><h3>Total</h3><p id="dashTotal">â‚±0</p></div>
</div>
</div>

<div id="cashflow" class="tabcontent">
<form id="transactionForm">
<select id="type">
<option value="cashin">Cash-In</option>
<option value="cashout">Cash-Out</option>
<option value="loading">Loading</option>
<option value="billspayment">Bills Payment</option>
</select>
<input type="number" id="amount" placeholder="Amount" required>
<button>Add</button>
</form>

<table>
<thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Fee</th><th>Profit</th></tr></thead>
<tbody id="txTable"></tbody>
</table>
</div>

<div id="rebalance" class="tabcontent">
<form id="rebalanceForm">
<select id="from"><option value="cash">Cash</option><option value="gcash">GCash</option></select>
<select id="to"><option value="cash">Cash</option><option value="gcash">GCash</option></select>
<input type="number" id="rebalanceAmount" required>
<button>Transfer</button>
</form>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
apiKey:"AIzaSyDF5BuG7cfbLhyIWJkgzKVNmXH9KtB4_AQ",
authDomain:"cashflowsystem-e8597.firebaseapp.com",
projectId:"cashflowsystem-e8597"
});
const db=firebase.firestore();
const bal=db.collection("balances").doc("main");

function calculateFee(amount){
if(amount<=100) return 5;
if(amount<=500) return 10;
if(amount<=1000) return 20;
if(amount<=1500) return 30;
if(amount<=2000) return 40;
if(amount<=2500) return 50;
return 50 + Math.ceil((amount-2500)/500)*10;
}

bal.onSnapshot(s=>{
const d=s.data()||{cash:0,gcash:0,profit:0};
dashCash.innerText="â‚±"+d.cash;
dashGcash.innerText="â‚±"+d.gcash;
dashProfit.innerText="â‚±"+d.profit;
dashTotal.innerText="â‚±"+(d.cash+d.gcash);
});

transactionForm.onsubmit=async e=>{
e.preventDefault();
const type=type.value;
const amt=+amount.value;
let fee=0,profit=0,cash=0,gc=0;

if(type==="cashin"){
fee=calculateFee(amt);
profit=fee;
gc=-amt;
cash=amt-fee;
}

if(type==="cashout"){
fee=calculateFee(amt);
profit=fee;
cash=-amt;
gc=amt-fee;
}

if(type==="loading"||type==="billspayment"){
fee=calculateFee(amt);
profit=fee;
gc=-(amt+fee);
cash=amt;
}

await bal.update({
cash:firebase.firestore.FieldValue.increment(cash),
gcash:firebase.firestore.FieldValue.increment(gc),
profit:firebase.firestore.FieldValue.increment(profit)
});

await db.collection("transactions").add({
date:new Date().toISOString(),type,amount:amt,fee,profit
});
};
function openTab(id,b){
document.querySelectorAll(".tabcontent").forEach(t=>t.style.display="none");
document.getElementById(id).style.display="block";
document.querySelectorAll(".tablink").forEach(x=>x.classList.remove("active"));
b.classList.add("active");
}
</script>
</body>
</html>
